apiVersion: secrets-store.csi.x-k8s.io/v1alpha1
kind: SecretProviderClass
metadata:
  name: aws-secrets
spec:
  provider: aws
  secretObjects:
    - data:
      - key: mysecret      # data field to populate
        objectName: MySecret   # name of the mounted content to sync. this could be the object name or the object alias 
      secretName: MySecret     # name of the Kubernetes Secret object
      type: Opaque         # type of the Kubernetes Secret object e.g. Opaque, kubernetes.io/tls

  parameters:
    objects: |
        - objectName: "MySecret"
          objectType: "secretsmanager"



---

kind: Pod
apiVersion: v1
metadata:
  name: nginx-deployment
spec:
  serviceAccountName: nginx-deployment-sa
  containers:
    - image: nginx
      name: nginx
      # imagePullPolicy: Never
      volumeMounts:
      - name: secrets-store-inline
        mountPath: "/mnt/secrets-store"
        readOnly: true
  volumes:
  - name: secrets-store-inline
    csi:
      driver: secrets-store.csi.k8s.io
      readOnly: true
      volumeAttributes:
        secretProviderClass: "aws-secrets"